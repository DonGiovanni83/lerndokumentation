<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>/sys-labs | Way-Up 2020-2022</title><meta name="description" content="Dokunentation meiner Ausbildung bei Puzzle ITC zum Systemtechniker EFZ."><meta itemprop="name" content="Fabio Bertagna"><meta itemprop="description" content="Dokunentation meiner Ausbildung bei Puzzle ITC zum Systemtechniker EFZ."><meta itemprop="image" content="/lerndokumentation/assets/images/tux.png"><meta property="og:url" content="/lerndokumentation/2020/07/24/sys-labs/"><meta property="og:type" content="website"><meta property="og:title" content="/sys-labs | Way-Up 2020-2022"><meta property="og:site_name" content="Way-Up 2020-2022"><meta property="og:description" content="Dokunentation meiner Ausbildung bei Puzzle ITC zum Systemtechniker EFZ."><meta property="og:image" content="/lerndokumentation/assets/images/tux.png"><link rel="icon" type="image/x-icon" href="/lerndokumentation/assets/images/favicon.ico"><link rel="stylesheet" href="/lerndokumentation/assets/css/app.css"><link rel="stylesheet" href="/lerndokumentation/assets/css/syntax.css"><link rel="alternate" type="application/rss+xml" title="Way-Up 2020-2022" href="/lerndokumentation/feed.xml"><link rel="canonical" href="/lerndokumentation/2020/07/24/sys-labs/"><base href="/lerndokumentation/" /></head><body id="sys-labs" class="post-layout"><header class="header"> <a class="header__title" href="/lerndokumentation/">Way-Up 2020-2022</a><nav><ul class="header__list"><li><a href="/lerndokumentation/">Home</a></li><li><a href="https://www.puzzle.ch/de/blog/articles/author/fbertagna">√úber mich</a></li></ul></nav></header><main class="üíà"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">/sys-labs</h2><time class="post__date" datetime="2020-07-24T00:00:00+00:00" itemprop="datePublished">24 Jul 2020</time></div></div><div class="post__img"><div><figure class="absolute-bg" style="background-image: url('/lerndokumentation/assets/images/tux.png');"></figure></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><p>Als Einstieg in die Way-Up Lehre bei Puzzle, hat das interne Sys-Team /sys-labs vorbereitet, welche die Grundlagen der Informatik behandeln und den Lernenden auf grundlegende T√§tigkeiten eines Systemadminsitrator bei Puzzle vorberetet. Diese Labs setzen keine Linux-Vorkenntnisse voraus, deshalb waren einige der Lab-Kapitel wiederholung f√ºr mich da ich schon Grundkenntnisse √ºber Linux mitbringe. Trotz meiner Vorkenntnissen gab es immer wieder interessante Erg√§nzungen und Hintergrund-Infos. Hier einige /sys-labs konnte ich verschiedene Bereiche einlesen und einarbeiten:</p><h2 id="1_commandline">1_commandline</h2><p>Das erste Kapitel hat die Grundlagen der Linux Kommandozeile abgedekt. Angefangen mit grundlegenden Befehlen wie sich z.B. in der Ordnerstruktur zu bewegen oder files erstellen und verschieben geht das Kapitel zu etwas aufregenderen Tasks wie z.B. suchen von Files oder Ordner mit Regex ausdr√ºcken.</p><p>Weiter wurden im Kapitel Streams STDOUT STDIN und STDERR angeschaut. Hier war interessant zu sehen wie man die einzelnen Streams unabh√§ngig von einander umleiten kann und auch mittels dem Pipeoperators komplexe Anreihungen von Befehlen bilden kann.</p><h2 id="2_git">2_git</h2><p>Das Versionierungstool git wir im N√§chsten Kapitel vorgestellt. Da mir dieses Tool bereits vertraut ist, war im Kapitel zu Beginn vieles Repetition. Neu dazulernen durfte ich die Art und Weise wie sich Git von anderen Versionsverwaltungstools unerscheidet beim</p><h2 id="3_troubleshooting">3_troubleshooting</h2><h2 id="4_ansible">4_ansible</h2><p>Um verschiedene Infrastrukturen automatisiert aufzusetzen und verwalten, wird bei Puzzle Ansible eingesetzt. Deshalb geh√∂ren die ansible-labs auch zur Grundausbildung eines Systemtechniker bei Puzzle. Mehr dazu, was ich in den ansible-labs lernen konnte in einem weiteren <a href="/lerndokumentation/2020/07/31/ansible-labs">Post</a>.</p><h2 id="5_scripting">5_scripting</h2><p>Als Teil der sys-labs ist in diesem Kapitel angedacht das Skripten mit Bash zu erlernen. Da aber die Unterlagen dieses Kapitels noch nicht bestehen, konnte ich mit eigenen Skripts Lernen Bash auf meinem Ubuntu anzuwenden.</p><p>Dazu habe ich einerseits w√§hrend den Tests f√ºr das Puzzle-Ubuntu-Setup ein Skript geschrieben, welches ein Ubuntu-Image baut mit preseed und andererseits, da ich mit drei Monitoren arbeite, ein kleines Skript zum Einstellen der Bildschirmhelligkeit aller Monitoren. Das Skript zum Puzzle-Ubuntu-Setup erkl√§re ich in diesem <a href="/lerndokumentation/2020/08/04/ubuntu-20.04-usb-preseed">Post</a>.</p><p>Mein Anforderung an das Skript <code class="language-plaintext highlighter-rouge">brightness-controller</code> war es, ja nach Parameter den man dem Skript √ºbergibt, alle mit dem Laptop verbundenen Displays heller oder dunkler zu machen. Dazu habe ich als Erstes den Mechanismus implementier welcher √ºberpr√ºft, dass das Skript richtig verwendet wird. Konkret heist das: Das Skript muss mit genau einem Parameter ausgef√ºhrt werden. Ansonsten wird die Ausf√ºhrung abgebrochen.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="k">if</span> <span class="o">[</span> <span class="s2">"$#"</span> <span class="nt">-ne</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"brightness-controller requires only one parameter"</span>
  <span class="nb">exit
</span><span class="k">fi</span>
</code></pre></div></div><p>Nach dieser √úberpr√ºfung soll der <code class="language-plaintext highlighter-rouge">brightness-controller</code> alle am System angeschlossenen Displays auslesen und in einem assoziativen Array Speichern. Darin sollen jeweils die ID auf die aktuelle Helligkeit der Displays gemapt werden.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c"># Deklarieren des Arrays der Displays</span>
<span class="nb">declare</span> <span class="nt">-A</span> displays

<span class="c"># Auslesen und verarbeiten der Display IDs</span>
<span class="k">for </span>DISP <span class="k">in</span> <span class="si">$(</span>xrandr <span class="nt">-q</span> | <span class="nb">grep</span> <span class="s2">" connected"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f1</span><span class="si">)</span>
<span class="k">do</span>
  <span class="c"># Auslesen der momentanen Helligkeit von DISP</span>
  displays[<span class="nv">$DISP</span><span class="o">]=</span><span class="s2">"</span><span class="si">$(</span>bc <span class="nt">-l</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="si">$(</span>xrandr <span class="nt">--verbose</span> | <span class="nb">grep</span> <span class="nv">$DISP</span> <span class="nt">-A5</span> | <span class="nb">tail</span> <span class="nt">-1</span> | <span class="nb">cut</span> <span class="nt">-f2</span> <span class="nt">-d</span> <span class="s1">' '</span> <span class="si">)</span><span class="s2"> * 10"</span><span class="si">)</span><span class="s2">"</span>

  <span class="c"># Optional zum Debuggen</span>
  <span class="c"># echo "display: $DISP"</span>
  <span class="c"># echo "brightness: ${displays[$DISP]}"</span>
<span class="k">done</span>

</code></pre></div></div><p>Sind die Display IDs und ihre aktuelle Helligkeit gespeichert, ist als N√§chstes zu √ºberpr√ºfen was f√ºr ein Parameter dem Skript mitgegeben wurde. Der <code class="language-plaintext highlighter-rouge">brightness-controller</code> soll nur <code class="language-plaintext highlighter-rouge">up</code> und <code class="language-plaintext highlighter-rouge">down</code> als Parameter akzeptieren. Also √ºberpr√ºfen wir das als N√§chstes:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>
<span class="nv">INPUT_COMMAND</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>

<span class="c"># check if input parameter is valid</span>
<span class="k">case</span> <span class="s2">"</span><span class="nv">$INPUT_COMMAND</span><span class="s2">"</span> <span class="k">in
  </span>up<span class="p">)</span>
    ...
    <span class="nb">exit</span>
    <span class="p">;;</span>
  down<span class="p">)</span>
    ...
    <span class="nb">exit</span>
    <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">echo</span> <span class="s2">"Invalid parameter - only valid parameters are 'up' or 'down'"</span>
<span class="k">esac</span>

</code></pre></div></div><p>Hier k√∂nnen wir nun das Erh√∂hen oder Verringern der Bildschirmhelligkeit implementieren. Mit dem tool xrandr, das wir zum Auslesen der Ger√§te ID verwendet haben, k√∂nnen wir auch die Helligkeit der Bildschirme einstellen. Hierbei ist einzig zu beachten, dass die Helligkeit zwischen 0 und 10.0 sein muss:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>
...

  up<span class="o">)</span>
    <span class="c"># Iteriere durch alle Displays im Array</span>
    <span class="k">for </span>DISP <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="p">!displays[@]</span><span class="k">}</span><span class="s2">"</span>
    <span class="k">do
      </span><span class="nv">VAL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">displays</span><span class="p">[</span><span class="nv">$DISP</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span>
      <span class="c"># echo $VAL</span>

      <span class="c"># Falls die Helligkeit gr√∂sser gleich 10 ist</span>
      <span class="c"># setze sie auf 10</span>
      <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">VAL</span><span class="p">%.*</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-ge</span> 10 <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">VAL</span><span class="o">=</span>10
      <span class="c"># ansonsten + 1</span>
      <span class="k">else
        </span><span class="nv">VAL</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>bc <span class="nt">-l</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$VAL</span><span class="s2"> + 1"</span><span class="si">)</span><span class="s2">"</span>
      <span class="k">fi</span>

      <span class="c"># echo "current VAL: $VAL"</span>

      <span class="c"># Schreibe die Helligkeit auf DISP</span>
      xrandr <span class="nt">--output</span> <span class="nv">$DISP</span> <span class="nt">--brightness</span> <span class="s2">"</span><span class="si">$(</span>bc <span class="nt">-l</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$VAL</span><span class="s2"> / 10"</span><span class="si">)</span><span class="s2">"</span>

    <span class="k">done
    </span><span class="nb">exit</span>
    <span class="p">;;</span>

...

</code></pre></div></div><p>F√ºr <code class="language-plaintext highlighter-rouge">down</code> kann es analog implementiert werden. Hier ist nur der Wertebereich der Helligkeit anders zu √ºberpr√ºfen und dementsprechend zu setzen:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>
...

      <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">VAL</span><span class="p">%.*</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-le</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">VAL</span><span class="o">=</span>0
      <span class="k">else
        </span><span class="nv">VAL</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>bc <span class="nt">-l</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$VAL</span><span class="s2"> - 1"</span><span class="si">)</span><span class="s2">"</span>
      <span class="k">fi</span>

...

</code></pre></div></div><p>Nun kann das Skript ausgef√ºhrt werden mit dem gew√ºnschten Parameter und die Bildschirme sollten ihre Helligkeit dementsprechend anpassen.</p><p>Damit das Skript nun nicht jedes Mal aus einem Terminal ausgef√ºhrt werden muss, habe ich im Ubuntu 20.04 zwei Keyboard-Shortcuts welche das Skript mit den Parametern <code class="language-plaintext highlighter-rouge">up</code> oder <code class="language-plaintext highlighter-rouge">down</code> ausf√ºhren.</p><p>Dazu kann man √ºber die Gnome Einstellungen √∂ffnen und danach entweder √ºber die Suche oder im Menu in die Sektion <em>Keyboard Shortucuts</em> navigieren. Scrollt man in der Liste bis ganz nach unten, kann nun einen Custom Shortcut hinzuf√ºgen. Hier kann man nun dem Shortcut einen sinnvollen Namen vergeben wie zum Beispiel <em>Increase brightness</em> und in der zweiten Option <em>Command</em> den Pfad zu dem <code class="language-plaintext highlighter-rouge">brightness-controller</code> Skript und den gew√ºnschten Parameter angeben. Der Shortcut k√∂nnte Beispielsweise so aussehen:</p><p><img src="/lerndokumentation/assets/images/custom-keyboard-shortcut.png" alt="Custom keyboard shortcut" /></p><h2 id="6_networking">6_networking</h2></div></div></div><div class="section-padding--none"><div class="grid"><hr class="sep"/></div></div><div class="section-padding"><div class="grid-small"> <span class="post__author">Posted by <a href="https://www.puzzle.ch/de/blog/articles/author/fbertagna" title="More By Fabio Bertagna">Fabio Bertagna</a></span><p class="post__bio"></p></div></div></article></div><section class="related section-padding"><div class="grid-xlarge"><h2 class="related__title">Related</h2><div class="related__container"><article class="related__post"> <a class="related__link" href="/lerndokumentation/2020/08/21/ubuntu-20.04-user-setup-mit-ansible/"><figure class="related__img"> <img src="/lerndokumentation/assets/images/pubuntu.png" alt="Ubuntu-20.04 - User-Setup mit Ansible"/></figure><div><h2 class="related__text">Ubuntu-20.04 - User-Setup mit Ansible</h2></div></a></article><article class="related__post"> <a class="related__link" href="/lerndokumentation/2020/08/04/ubuntu-20.04-usb-preseed/"><figure class="related__img"> <img src="/lerndokumentation/assets/images/ubuntu-preseed.png" alt="Ubuntu 20.04 - Bootable USB Key mit preseed"/></figure><div><h2 class="related__text">Ubuntu 20.04 - Bootable USB Key mit preseed</h2></div></a></article><article class="related__post"> <a class="related__link" href="/lerndokumentation/2020/07/24/sys-labs/"><figure class="related__img"> <img src="/lerndokumentation/assets/images/tux.png" alt="/sys-labs"/></figure><div><h2 class="related__text">/sys-labs</h2></div></a></article></div></div></section></main><footer class="footer section-padding"><div class="grid"><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"><li><a class="footer__link" href="/tag/linux">Linux</a></li><li><a class="footer__link" href="/tag/ansible">Ansible</a></li><li><a class="footer__link" href="/tag/ubuntu">Ubuntu</a></li><li><a class="footer__link" href="/tag/prometheus">Prometheus</a></li></ul></div></div></footer><script src="/lerndokumentation/assets/js/app.min.js"></script></body></html>
  